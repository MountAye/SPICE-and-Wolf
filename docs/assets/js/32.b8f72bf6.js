(window.webpackJsonp=window.webpackJsonp||[]).push([[32],{446:function(e,s,o){"use strict";o.r(s);var t=o(43),n=Object(t.a)({},(function(){var e=this,s=e.$createElement,o=e._self._c||s;return o("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[o("h1",{attrs:{id:"有关-root-的二三事"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#有关-root-的二三事"}},[e._v("#")]),e._v(" 有关 root 的二三事")]),e._v(" "),o("p",[e._v("相信大部分人对“root 权限”的认识，是从 Android 开始的。大多数人的印象大概是：root 权限是一个非常高也非常危险的权限，使用这个权限的时候，一不小心就会把系统搞坏。")]),e._v(" "),o("p",[e._v("前半句没错，后半句——GNU/Linux（尤其是给桌面用户用的那些发行版），在这方面还是比较友好的。")]),e._v(" "),o("h2",{attrs:{id:"什么是-root-权限？"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#什么是-root-权限？"}},[e._v("#")]),e._v(" 什么是 root 权限？")]),e._v(" "),o("p",[e._v("这里的 root 权限，实际上指的是名为 root 的账户所具有的权限。“获取 root 权限”，指的实际是获取 root 账户的使用权。root 是系统中权限最高的用户。和 Windows 的 Administrator 相比，权限不知道高到哪里去了。（"),o("em",[e._v("注：在 Windows 中想获取较高的权限，可以使用 NSudo")]),e._v("）举个例子：Administrator 是删除不了 "),o("code",[e._v("explorer.exe")]),e._v(" 文件的，而 root 可以删除你当前正在使用的 shell 。")]),e._v(" "),o("h2",{attrs:{id:"切换到-root-账户"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#切换到-root-账户"}},[e._v("#")]),e._v(" 切换到 root 账户")]),e._v(" "),o("p",[e._v("使用命令 "),o("code",[e._v("su")]),e._v(" 。")]),e._v(" "),o("p",[e._v("Android 上的软件，实际上就是这样获取你授予它的 root 权限的。当然，会有一定的验证措施。在手机上通常是弹框确认，而在电脑上，通常会要求用户输入 root 账户的密码。")]),e._v(" "),o("h2",{attrs:{id:"我不知道-root-账户的密码，怎么办？"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#我不知道-root-账户的密码，怎么办？"}},[e._v("#")]),e._v(" 我不知道 root 账户的密码，怎么办？")]),e._v(" "),o("p",[e._v("在许多桌面发行版（如 Ubuntu Desktop）中，root 账户默认是不被用户直接接触的。如 Ubuntu，其 root 账户默认是被禁用的。在这种情况下，用户通过 "),o("code",[e._v("sudo")]),e._v(" 命令获取 root 账户的使用权。")]),e._v(" "),o("p",[e._v("对 "),o("code",[e._v("sudo apt-get ...")]),e._v(" 不陌生吧？对，这就是 "),o("code",[e._v("sudo")]),e._v(" 的用法了。"),o("strong",[e._v("注意")]),e._v("，在使用 "),o("code",[e._v("sudo")]),e._v(" 的时候，它询问的是"),o("strong",[e._v("你自己账户的密码")]),e._v("，而不是 root 账户的密码。")]),e._v(" "),o("p",[e._v("想切换到 root 权限的 shell？也用这样的方法， "),o("code",[e._v("sudo -i")])]),e._v(" "),o("h2",{attrs:{id:"sudo-可以让任何人使用-root-账户？那岂不是太不安全了！"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#sudo-可以让任何人使用-root-账户？那岂不是太不安全了！"}},[e._v("#")]),e._v(" sudo 可以让任何人使用 root 账户？那岂不是太不安全了！")]),e._v(" "),o("p",[e._v("并不是的呢。 sudo 君有一个小名单，只有名单上的人才可以使用 sudo。这个名单就是 "),o("code",[e._v("/etc/sudoers")]),e._v(" 。")]),e._v(" "),o("p",[e._v("在 Redhat 系统上，很多人在使用 sudo 时会发现这样的提示：")]),e._v(" "),o("blockquote",[o("p",[e._v("用户不在 sudoers 文件中。此事将被报告。")])]),e._v(" "),o("p",[e._v("为什么呢？ Redhat 系的发行版，似乎不默认把安装时建立的用户加入 sudoer，sudo 君自然就不会放行啦。")]),e._v(" "),o("p",[e._v("如想编辑 "),o("code",[e._v("/etc/sudoers")]),e._v(" ，建议使用 "),o("code",[e._v("visudo")]),e._v("。")]),e._v(" "),o("h3",{attrs:{id:"etc-sudoers"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#etc-sudoers"}},[e._v("#")]),e._v(" /etc/sudoers")]),e._v(" "),o("p",[e._v("sudo 的配置文件是 "),o("code",[e._v("/etc/sudoers")]),e._v(" 。visudo会锁住 sudoers 文件，保存修改到临时文件，然后检查文件格式，确保正确后才会覆盖 sudoers 文件。必须保证 sudoers 格式正确，否则 sudo 将无法运行。")]),e._v(" "),o("div",{staticClass:"language-text extra-class"},[o("pre",{pre:!0,attrs:{class:"language-text"}},[o("code",[e._v("# visudo\n")])])]),o("p",[e._v("看名字就知道它会用 vi 啦，如果汝想换一个自己喜欢的编辑器的话，可以用 "),o("code",[e._v("EDITOR")]),e._v(" 环境变量设置：")]),e._v(" "),o("div",{staticClass:"language-text extra-class"},[o("pre",{pre:!0,attrs:{class:"language-text"}},[o("code",[e._v("# EDITOR=vim visudo\n")])])]),o("h3",{attrs:{id:"wheel-组"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#wheel-组"}},[e._v("#")]),e._v(" wheel 组")]),e._v(" "),o("p",[e._v("很多系统在 "),o("code",[e._v("/etc/sudoers")]),e._v(" 都有这条预置策略： "),o("code",[e._v("wheel")]),e._v(" 组的所有成员都可以使用 "),o("code",[e._v("sudo")]),e._v("。所以，如果想让一位用户使用 "),o("code",[e._v("sudo")]),e._v("，最简单的方法就是将此用户加入"),o("code",[e._v("wheel")]),e._v("组：")]),e._v(" "),o("div",{staticClass:"language-text extra-class"},[o("pre",{pre:!0,attrs:{class:"language-text"}},[o("code",[e._v("# usermod -G (追加用户到组) {组名} {用户名}\nusermod -G wheel <用户名>\n# gpasswd 也有类似的作用\ngpasswd -a <用户名> wheel\n")])])]),o("h3",{attrs:{id:"编辑-sudoers-文件"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#编辑-sudoers-文件"}},[e._v("#")]),e._v(" 编辑 sudoers 文件")]),e._v(" "),o("div",{staticClass:"language-text extra-class"},[o("pre",{pre:!0,attrs:{class:"language-text"}},[o("code",[e._v('## sudoers file.\n##\n## This file MUST be edited with the \'visudo\' command as root.\n## Failure to use \'visudo\' may result in syntax or file permission errors\n## that prevent sudo from running.\n##\n## See the sudoers man page for the details on how to write a sudoers file.\n##\n\n##\n## Host alias specification\n## 主机名别名\n## Groups of machines. These may include host names (optionally with wildcards),\n## IP addresses, network numbers or netgroups.\n# Host_Alias    WEBSERVERS = www1, www2, www3\n\n##\n## User alias specification\n## 用户别名\n## Groups of users.  These may consist of user names, uids, Unix groups,\n## or netgroups.\n# User_Alias    ADMINS = millert, dowdy, mikef\n\n##\n## Cmnd alias specification\n## 命令别名\n## Groups of commands.  Often used to group related commands together.\n# Cmnd_Alias    PROCESSES = /usr/bin/nice, /bin/kill, /usr/bin/renice, \\\n#                 /usr/bin/pkill, /usr/bin/top\n# Cmnd_Alias    REBOOT = /sbin/halt, /sbin/reboot, /sbin/poweroff\n\n##\n## Defaults specification\n## 默认参数（例如保持各种环境变量等等，按需取消注释即可）\n## You may wish to keep some of the following environment variables\n## when running commands via sudo.\n##\n## Locale settings\n# Defaults env_keep += "LANG LANGUAGE LINGUAS LC_* _XKB_CHARSET"\n##\n## Run X applications through sudo; HOME is used to find the\n## .Xauthority file.  Note that other programs use HOME to find   \n## configuration files and this may lead to privilege escalation!\n# Defaults env_keep += "HOME"\n##\n## X11 resource path settings\n# Defaults env_keep += "XAPPLRESDIR XFILESEARCHPATH XUSERFILESEARCHPATH"\n##\n## Desktop path settings\n# Defaults env_keep += "QTDIR KDEDIR"\n##\n## Allow sudo-run commands to inherit the callers\' ConsoleKit session\n# Defaults env_keep += "XDG_SESSION_COOKIE"\n##\n## Uncomment to enable special input methods.  Care should be taken as\n## this may allow users to subvert the command being run via sudo.\n# Defaults env_keep += "XMODIFIERS GTK_IM_MODULE QT_IM_MODULE QT_IM_SWITCHER"\n##\n## Uncomment to use a hard-coded PATH instead of the user\'s to find commands\n# Defaults secure_path="/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"\n##\n## Uncomment to send mail if the user does not enter the correct password.\n# Defaults mail_badpass\n##\n## Uncomment to enable logging of a command\'s output, except for\n## sudoreplay and reboot.  Use sudoreplay to play back logged sessions.\n# Defaults log_output\n# Defaults!/usr/bin/sudoreplay !log_output\n# Defaults!/usr/local/bin/sudoreplay !log_output\n# Defaults!REBOOT !log_output\n\n##\n## Runas alias specification\n##\n\n##\n## User privilege specification\n##\n## 按用户分配权限。\n## 用户名 主机名 = 命令\nroot ALL=(ALL) ALL\n\n## 要为某个用户可以执行所有命令，在配置文件中加入：\n## 用户名   ALL=(ALL) ALL\n\n## 如果只想允许以某个主机名登录用户执行命令：\n## 用户名   主机名=(ALL) ALL\n\n## 允许wheel用户组成员无密码使用sudo：\n## %wheel      ALL=(ALL) NOPASSWD: ALL\n\n## 要不询问某个用户的密码:\n## Defaults:USER_NAME      !authenticate\n\n## 只为用户启用部分命令的执行权限：\n## 用户名 主机名=/sbin/halt,/sbin/poweroff,/sbin/reboot,/usr/bin/pacman -Syu\n\n## 按组分配权限\n## Uncomment to allow members of group wheel to execute any command\n%wheel ALL=(ALL) ALL\n\n## 如果希望不需要密码使用 sudo\n## Same thing without a password\n# %wheel ALL=(ALL) NOPASSWD: ALL\n\n## Uncomment to allow members of group sudo to execute any command\n# %sudo    ALL=(ALL) ALL\n\n## Uncomment to allow any user to run sudo if they know the password\n## of the user they are running the command as (root by default).\n# Defaults targetpw  # Ask for the password of the target user\n# ALL ALL=(ALL) ALL  # WARNING: only use this together with \'Defaults targetpw\'\n\n## 从 /etc/sudoers.d/ 中读取追加设置（这里的 # 不是注释）\n## Read drop-in files from /etc/sudoers.d\n## (the \'#\' here does not indicate a comment)\n#includedir /etc/sudoers.d\n')])])]),o("p",[e._v("更多的设置范例可以参考 "),o("a",{attrs:{href:"http://www.gratisoft.us/sudo/man/sudoers.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("sudo 用户手册"),o("OutboundLink")],1)]),e._v(" "),o("h2",{attrs:{id:"su-和-sudo-怎么拿到-root-权限的？"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#su-和-sudo-怎么拿到-root-权限的？"}},[e._v("#")]),e._v(" su 和 sudo 怎么拿到 root 权限的？")]),e._v(" "),o("p",[e._v("让我们看一看 "),o("code",[e._v("ls -l /bin/su")]),e._v(" 和 "),o("code",[e._v("ls -l /usr/bin/sudo")]),e._v(" 的权限：")]),e._v(" "),o("div",{staticClass:"language-text extra-class"},[o("pre",{pre:!0,attrs:{class:"language-text"}},[o("code",[e._v("-rwsr-xr-x 1 root root （其后省略）\n")])])]),o("p",[e._v("这里的小写字母 s 是一个有点特殊的权限：SUID。通俗地说，拥有这个权限的可执行程序，在运行时会拥有其所有者的权限（即 Set UID），于是 "),o("code",[e._v("su")]),e._v(" 和 "),o("code",[e._v("sudo")]),e._v(" 就得到了 root 权限（当然，不一定会给所有调用它们的人）。")])])}),[],!1,null,null,null);s.default=n.exports}}]);